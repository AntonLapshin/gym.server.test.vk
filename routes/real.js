var Db=require("../db"),$=require("jquery-deferred"),_rates={money:20,gold:1},_bonus=.05;module.exports={"default":{params:{type:{required:!0},id:{required:!0,parseMethod:parseInt},real:{required:!0,parseMethod:parseInt}},handler:function(e,r){var s=r.type,a=r.id,t=r.real;if(!e.pendingPayment||e.pendingPayment.amount!=t)return $.Deferred(function(e){e.resolve({success:!1})});var i={success:!0};if("gyms"===s||"food"===s||"rest"===s||"stimul"===s)e.player["private"][s].push(a),i.purchase={type:s,id:a,success:!0};else if("exercises"===s)e.player["public"][s].push({_id:a}),i.purchase={type:s,id:a,success:!0};else if("money"===s||"gold"===s){var u=Math.floor(t*_rates[s]+t*_bonus*(t*_rates[s]));e.player["private"][s]+=u,i[s]=u}var d=$.Deferred();return e.pendingPayment=null,e.isDirty=!0,d.resolve(i),d}}};