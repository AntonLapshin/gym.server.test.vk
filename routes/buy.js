function add(e,r,s){e.player["public"][r]=s,e.player["public"][r+"s"]||(e.player["public"][r+"s"]=[]),-1==e.player["public"][r+"s"].indexOf(s)&&e.player["public"][r+"s"].push(s)}var Db=require("../db"),$=require("jquery-deferred");module.exports={"default":{params:{type:{required:!0},id:{required:!0,parseMethod:parseInt}},handler:function(e,r){var s,p=r.type,a=r.id;if("gyms"===p||"exercises"===p)s=Db.getRefs()[p][a];else{var i=$.grep(Db.getRefs().shop,function(e){return e.name===p})[0];s=i.items[a]}var l={success:!1,purchase:{type:p,id:a,success:!1}},u=$.Deferred(),d=s.money||0,c=s.gold||0;return e.player["private"].gold<c||e.player["private"].money<d?(u.resolve(l),u):(c>0&&(e.player["private"].gold-=c,l.gold=-c),d>0&&(e.player["private"].money-=d,l.money=-d),l.success=l.purchase.success=!0,"exercises"===p?e.player["public"].exercises.push({_id:a}):"hs"===p||"bd"===p||"gl"===p?add(e,p,a):e.player["private"][p].push(a),e.isDirty=!0,u.resolve(l),u)}}};