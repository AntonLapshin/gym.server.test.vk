var Db=require("../db"),$=require("jquery-deferred");module.exports={"default":{params:{type:{required:!0},id:{required:!0,parseMethod:parseInt}},handler:function(e,r){var s,p=r.type,a=r.id;if("gyms"===p||"exercises"===p)s=Db.getRefs()[p][a];else{var i=$.grep(Db.getRefs().shop,function(e){return e.name===p})[0];s=i.items[a]}var t={success:!1,purchase:{type:p,id:a,success:!1}},u=$.Deferred(),d=s.money||0,l=s.gold||0;return e.player["private"].gold<l||e.player["private"].money<d?(u.resolve(t),u):(l>0&&(e.player["private"].gold-=l,t.gold=-l),d>0&&(e.player["private"].money-=d,t.money=-d),t.success=t.purchase.success=!0,"exercises"===p?e.player["public"].exercises.push({_id:a}):e.player["private"][p].push(a),e.isDirty=!0,u.resolve(t),u)}}};