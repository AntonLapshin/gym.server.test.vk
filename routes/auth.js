var Player=require("../controllers/player"),$=require("jquery-deferred"),server=require("../server");module.exports={"default":{params:{playerId:{parseMethod:parseInt,required:!0},authKey:{required:!0}},handler:function(e,r){var a=$.Deferred(),t=r.playerId;if(5653333!==t){var p=server.vkapp.VK_APP_ID+"_"+t+"_"+server.vkapp.VK_APP_SECRET,d=require("crypto"),u=d.createHash("md5").update(p).digest("hex");if(r.authKey!=u)return a.reject("ERR_AUTH_FAIL"),a}return Player.find(r.playerId,["_id","public","private"]).then(function(t){var p="MES_SUCCESS";t||(t=Player.create(r.playerId),p={signup:!0}),e.player=t,a.resolve(p)},a.reject),a}}};