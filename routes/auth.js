var Player=require("../controllers/player"),Coach=require("../controllers/coach"),$=require("jquery-deferred"),server=require("../server");module.exports={"default":{params:{playerId:{parseMethod:parseInt,required:!0},authKey:{required:!0}},handler:function(e,r){var a=$.Deferred(),l=r.playerId;if(5653333!==l){var t=server.vkapp.VK_APP_ID+"_"+l+"_"+server.vkapp.VK_APP_SECRET,p=require("crypto"),u=p.createHash("md5").update(t).digest("hex");if(r.authKey!=u)return a.reject("ERR_AUTH_FAIL"),a}return Player.find(r.playerId,["_id","public","private"]).then(function(l){var t="MES_SUCCESS";l?l["public"].coach?Coach.get(l._id).then(function(r){l["public"].coach=r,e.player=l,a.resolve(t)}):(e.player=l,a.resolve(t)):(l=Player.create(r.playerId),t={signup:!0},e.player=l,a.resolve(t))},a.reject),a}}};