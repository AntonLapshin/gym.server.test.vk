function getCat(e){return $.grep(WCATS,function(n){return n>e})[0]}function getRank(e,n){var r=$.grep(T[e],function(e){return n>=e});return 0===r.length?null:r.length-1}function getRanks(e){for(var n=[],r=[].concat(e["public"].ranks||[]),t=0;t<WCATS.length;t++){var u=r.pop();if(!u)break;n[parseInt(u[0])]=parseInt(u[1])}return n}function setRanks(e,n){for(var r=[],t=0;t<n.length;t++){var u=n[t];u&&r.push(""+t+u)}e["public"].ranks=r}function hasRank(e,n,r){return(e[n]||-1)>=r}function getSum(e){var n=[];e["public"].exercises.forEach(function(e){2!==e._id&&3!==e._id&&4!==e._id||n.push(e?e.pr||0:0)});var r=$.sum(n);return r}var curve=require("./curve"),$=require("jquery-deferred"),WCATS=[53,59,66,74,83,93,105,120,200],T=[[260,282.5,325,410],[290,315,362.5,455,570,625],[320,350,402.5,510,635,700],[352.5,385,440,537.5,695,770],[387.5,422,482.5,582.5,747.5,835],[412.5,465,520,610,787.5,880],[460,500,552.5,645,815,920],[497.5,530,600,687.5,835,955],[510,545,617.5,735,860,980]],PRIZE=[["0,1","0,3","0,6","0,8"],["0,1","0,4","0,8","0,12","0,14","1,2"],["0,2","0,5","0,10","0,15","0,20","1,8"],["0,2","0,6","0,12","0,18","0,24","1,14"],["0,3","0,7","0,14","0,21","0,28","1,20"],["0,3","0,8","0,16","0,24","0,32","1,24"],["0,4","0,9","0,18","0,27","0,36","1,28"],["0,4","0,10","0,20","0,30","1,12","1,32"],["0,5","0,11","0,22","0,33","1,20","2,25"]];module.exports={update:function(e){var n=curve.getMass(e["public"].level),r=getCat(n),t=WCATS.indexOf(r),u=getSum(e),a=getRank(t,u);if(null===a)return null;var l=getRanks(e);return hasRank(l,t,a)?void 0:(l[t]=a,setRanks(e,l),a)},getSalary:function(e){var n=curve.getMass(e["public"].level),r=getCat(n),t=WCATS.indexOf(r),u=getSum(e),a=getRank(t,u);if(null===a)return null;var l=PRIZE[t][a];return null==l?null:(l=l.split(","),{gold:parseInt(l[0]),money:parseInt(l[1])})}};