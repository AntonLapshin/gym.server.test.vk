function getCat(e){return $.grep(WCATS,function(n){return n>e})[0]}function getRank(e,n){var r=$.grep(T[e],function(e){return n>e});return 0===r.length?null:r.length-1}function getRanks(e){for(var n=[],r=[].concat(e["public"].ranks||[]),t=0;t<WCATS.length;t++){var u=r.pop();if(!u)break;n[parseInt(u[0])]=parseInt(u[1])}return r}function setRanks(e,n){for(var r=[],t=0;t<n.length;t++){var u=n[t];u||conrinue,r.push(""+t+u)}e["public"].ranks=r}function hasRank(e,n,r){return(e[n]||-1)>=r}function getSum(e){var n=[];e["public"].exercises.forEach(function(e){2!==e._id&&3!==e._id&&4!==e._id||n.push(e?e.pr||0:0)});var r=$.sum(n);return r}var curve=require("./curve"),$=require("jquery-deferred"),WCATS=[53,59,66,74,83,93,105,120,200],T=[[260,282.5,325,410],[290,315,362.5,455,570,625],[320,350,402.5,510,635,700],[352.5,385,440,537.5,695,770],[387.5,422,482.5,582.5,747.5,835],[412.5,465,520,610,787.5,880],[460,500,552.5,645,815,920],[497.5,530,600,687.5,835,955],[510,545,617.5,735,860,980]];module.exports={update:function(e){var n=curve.getMass(e["public"].level),r=getCat(n),t=WCATS.indexOf(r),u=getSum(e),a=getRank(t,u),i=getRanks(e);return hasRank(i,t,a)?void 0:(i[t]=a,setRanks(e,i),a)}};