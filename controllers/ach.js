function addExercise(e,r,t){0===$.grep(e["public"].exercises,function(e){return e._id===r}).length&&(e["public"].exercises.push({_id:r}),t.purchase={success:!0,type:"exercises",id:r})}function addGym(e,r,t){-1===e["private"].gyms.indexOf(r)&&(e["private"].gyms.push(r),t.purchase={success:!0,type:"gyms",id:r})}function round(e){return Math.round(100*e)/100}var Db=require("../db"),Player=require("./player"),$=require("jquery-deferred"),achList=[function(e,r){var t=e["private"].coach.hired===!0;return t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t=r.player&&254444141==r.player._id;return t&&addGym(e,0,r),t},function(e,r){var t=1===r.id&&r.fact>=1&&r.weight>=0;return t&&(e["private"].money+=3,r.money=3),t},function(e,r){var t=2===r.id&&r.fact>=1&&r.weight>=40;return t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t="success"===r.job;return t&&addExercise(e,3,r),t},function(e,r){var t=r.purchase;if(!t)return!1;var n="food"===t.type&&t.success===!0;return n&&(e["private"].money+=3,r.money=3),n},function(e,r){var t=r.purchase;if(!t)return!1;var n="rest"===t.type&&t.success===!0;return n&&(e["private"].money+=5,r.money=5),n},function(e,r){var t=1==r.levelChange;return t&&addExercise(e,4,r),t},function(e,r){var t=0===r.id&&r.fact>=1&&r.weight>=0;return t&&(e["private"].money+=5,r.money=5),t},function(e,r){var t=!0;return e["private"].body.forEach(function(e){return 1!=e.stress?(t=!1,!1):void 0}),t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t=3===r.exerciseId&&100===r.weight&&r.repeats>0;return t&&(e["private"].gold+=1,r.gold=1),t}];module.exports={handler:function(e,r){var t=e.player;if("object"==typeof r&&r!==t){var n=[],i=t["private"].achievements;achList.forEach(function(e,a){-1===i.indexOf(a)&&e(t,r)&&(n.push(a),i.push(a))}),n.length>0&&(r.newAchievements=n,e.isDirty=!0)}}};