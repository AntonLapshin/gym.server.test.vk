function addExercise(e,r,t){0===$.grep(e["public"].exercises,function(e){return e._id===r}).length&&(e["public"].exercises.push({_id:r}),t.purchase={success:!0,type:"exercises",id:r})}function addGym(e,r,t){-1===e["private"].gyms.indexOf(r)&&(e["private"].gyms.push(r),t.purchase={success:!0,type:"gyms",id:r})}function round(e){return Math.round(100*e)/100}var Db=require("../db"),Player=require("./player"),Coach=require("./coach"),$=require("jquery-deferred"),achList=[function(e,r){var t=e["private"].coach;return t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t=r.player&&r.player["public"].coach;return t&&addGym(e,0,r),t},function(e,r){var t=1===r.id&&r.fact>=1&&r.weight>=0;return t&&(e["private"].money+=3,r.money=3),t},function(e,r){var t=2===r.id&&r.fact>=1&&r.weight>=40;return t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t="success"===r.job;return t&&addExercise(e,3,r),t},function(e,r){var t=r.purchase;if(!t)return!1;var n="food"===t.type&&t.success===!0;return n&&(e["private"].money+=3,r.money=3),n},function(e,r){var t=r.purchase;if(!t)return!1;var n="rest"===t.type&&t.success===!0;return n&&(e["private"].money+=5,r.money=5),n},function(e,r){var t=1==r.levelChange;return t&&addExercise(e,4,r),t},function(e,r){var t=0===r.id&&r.fact>=1&&r.weight>=0;return t&&(e["private"].money+=5,r.money=5),t},function(e,r,t){var n=(t.query.garb,0===e["private"].garb);return n&&(e["private"].money+=10,r.money=10),n},function(e,r){var t=!0;return e["private"].body.forEach(function(e){return 1!=e.stress?(t=!1,!1):void 0}),t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t=e["public"].level>=7;return t&&addGym(e,1,r),t},function(e,r){var t=0===r.id&&r.weight>=0&&r.fact>=10;return t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t=4===r.id&&r.weight>=90&&r.fact>=1;return t&&addExercise(e,5,r),t},function(e,r){var t=3===r.id&&r.weight>=100&&r.fact>=1;return t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t=e["public"].level>=14;return t&&addExercise(e,6,r),t},function(e,r){var t=6===r.id&&r.weight>=40&&r.fact>=1;return t&&addExercise(e,7,r),t},function(e,r){var t=e["public"].level>=19;return t&&(e["private"].money+=20,r.money=20,e["private"].gold+=2,r.gold=2),t},function(e,r){var t=e["public"].level>=23;return t&&(e["private"].money+=30,r.money=30,e["private"].gold+=3,r.gold=3),t},function(e,r){var t=e["public"].level>=28;return t&&addGym(e,2,r),t},function(e,r){var t=e["public"].level>=34;return t&&(e["private"].money+=40,r.money=40,e["private"].gold+=4,r.gold=4),t},function(e,r){var t=1===r.id&&r.weight>=0&&r.fact>=10;return t&&(e["private"].money+=5,r.money=5),t},function(e,r){var t=2===r.id&&r.fact>=1&&r.weight>=60;return t&&(e["private"].gold+=1,r.gold=1),t},function(e,r){var t=!0,t=1==e["private"].body[6].stress;return t&&(e["private"].money+=3,r.money=3),t},function(e,r){var t=!0,t=1==e["private"].body[13].stress;return t&&(e["private"].money+=5,r.money=5),t},function(e,r){var t=r.purchase;if(!t)return!1;var n="stimul"===t.type&&t.success===!0;return n&&(e["private"].money+=8,r.money=8),n},function(e,r){var t=e["public"].level>=15;return t&&(e["private"].gold+=1,r.gold=1,r.coach=!0,e["public"].coach=Coach.create(e._id)),t}];module.exports={handler:function(e,r,t){var n=e.player;if("object"==typeof r&&r!==n){var i=[],a=n["private"].achievements;achList.forEach(function(e,u){-1===a.indexOf(u)&&e(n,r,t)&&(i.push(u),a.push(u))}),i.length>0&&(r.newAchievements=i,e.isDirty=!0)}}};