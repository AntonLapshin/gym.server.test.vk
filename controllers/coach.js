var Db=require("../db"),CoachesCollection=require("../gymdb/collections/coaches"),$=require("jquery-deferred"),LIMIT_TOP_COACHES=20;module.exports={create:function(e){var n=CoachesCollection.newCoach(e);return Db.insert("coaches",n),n},dec:function(e){return Db.update("coaches",e,{$inc:{q:-1}})},inc:function(e){return Db.update("coaches",e,{$inc:{q:1}})},getPay:function(e){return Db.update("coaches",e,{s:0})},earn:function(e,n){return Db.update("coaches",e,{$inc:{s:n}})},update:function(e,n,c){var r={s:n,q:c};return Db.update("coaches",e,r)},exists:function(e){return Db.exists("coaches",e)},get:function(e){return Db.find("coaches",e,{s:1,q:1})},remove:function(e){return Db.remove("coaches",e)},top:function(){return $.Deferred(function(e){Db.getColl("coaches").find({$query:{},$orderby:{q:-1}},{_id:1,s:1,q:1}).limit(LIMIT_TOP_PLAYERS).toArray(function(n,c){$.handle(n,c,e)})})},getCoaches:function(e){return $.Deferred(function(n){Db.getColl("coaches").find({_id:{$in:e}},{_id:1,s:1,q:1}).limit(LIMIT_TOP_COACHES).toArray(function(e,c){$.handle(e,c,n)})})}};